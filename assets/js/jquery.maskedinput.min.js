!function(e){function t(){var e=document.createElement("input"),t="onpaste";return e.setAttribute(t,""),"function"==typeof e[t]?"paste":"input"}var i,n=t()+".mask",a=navigator.userAgent,r=/iphone/i.test(a),o=/android/i.test(a);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var i;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&(i=this.createTextRange(),i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),e=0-i.duplicate().moveStart("character",-1e5),t=e+i.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,a){var s,l,d,c,u,h;return!t&&this.length>0?(s=e(this[0]),s.data(e.mask.dataName)()):(a=e.extend({placeholder:e.mask.placeholder,completed:null},a),l=e.mask.definitions,d=[],c=h=t.length,u=null,e.each(t.split(""),function(e,t){"?"==t?(h--,c=e):l[t]?(d.push(new RegExp(l[t])),null===u&&(u=d.length-1)):d.push(null)}),this.trigger("unmask").each(function(){function s(e){for(;++e<h&&!d[e];);return e}function f(e){for(;--e>=0&&!d[e];);return e}function p(e,t){var i,n;if(!(0>e)){for(i=e,n=s(t);h>i;i++)if(d[i]){if(!(h>n&&d[i].test(F[n])))break;F[i]=F[n],F[n]=a.placeholder,n=s(n)}y(),w.caret(Math.max(u,e))}}function m(e){var t,i,n,r;for(t=e,i=a.placeholder;h>t;t++)if(d[t]){if(n=s(t),r=F[t],F[t]=i,!(h>n&&d[n].test(r)))break;i=r}}function g(e){var t,i,n,a=e.which;8===a||46===a||r&&127===a?(t=w.caret(),i=t.begin,n=t.end,0===n-i&&(i=46!==a?f(i):n=s(i-1),n=46===a?s(n):n),b(i,n),p(i,n-1),e.preventDefault()):27==a&&(w.val(k),w.caret(0,x()),e.preventDefault())}function v(t){var i,n,r,l=t.which,c=w.caret();t.ctrlKey||t.altKey||t.metaKey||32>l||l&&(0!==c.end-c.begin&&(b(c.begin,c.end),p(c.begin,c.end-1)),i=s(c.begin-1),h>i&&(n=String.fromCharCode(l),d[i].test(n)&&(m(i),F[i]=n,y(),r=s(i),o?setTimeout(e.proxy(e.fn.caret,w,r),0):w.caret(r),a.completed&&r>=h&&a.completed.call(w))),t.preventDefault())}function b(e,t){var i;for(i=e;t>i&&h>i;i++)d[i]&&(F[i]=a.placeholder)}function y(){w.val(F.join(""))}function x(e){var t,i,n=w.val(),r=-1;for(t=0,pos=0;h>t;t++)if(d[t]){for(F[t]=a.placeholder;pos++<n.length;)if(i=n.charAt(pos-1),d[t].test(i)){F[t]=i,r=t;break}if(pos>n.length)break}else F[t]===n.charAt(pos)&&t!==c&&(pos++,r=t);return e?y():c>r+1?(w.val(""),b(0,h)):(y(),w.val(w.val().substring(0,r+1))),c?t:u}var w=e(this),F=e.map(t.split(""),function(e){return"?"!=e?l[e]?a.placeholder:e:void 0}),k=w.val();w.data(e.mask.dataName,function(){return e.map(F,function(e,t){return d[t]&&e!=a.placeholder?e:null}).join("")}),w.attr("readonly")||w.one("unmask",function(){w.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){clearTimeout(i);var e;k=w.val(),e=x(),i=setTimeout(function(){y(),e==t.length?w.caret(0,e):w.caret(e)},10)}).bind("blur.mask",function(){x(),w.val()!=k&&w.change()}).bind("keydown.mask",g).bind("keypress.mask",v).bind(n,function(){setTimeout(function(){var e=x(!0);w.caret(e),a.completed&&e==w.val().length&&a.completed.call(w)},0)}),x()}))}})}(jQuery);